# ==========================================================================================
# NVIDIA GPU Support for Ollama
# ==========================================================================================
# Prerequisites:
#   1. NVIDIA GPU with CUDA support
#   2. NVIDIA Driver installed on host (version 525+ recommended)
#   3. Docker with NVIDIA Container Toolkit:
#      https://docs.nvidia.com/datacenter/cloud-native/container-toolkit/install-guide.html
# ------------------------------------------------------------------------------------------
# Usage:
#   docker compose -f docker-compose.yml -f docker-compose.nvidia.yml up
# ------------------------------------------------------------------------------------------
# Verify GPU is being used:
#   docker compose exec ollama nvidia-smi
# ==========================================================================================

services:
  ollama:
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: all  # Use all available GPUs
              capabilities: [gpu]
    
    # Optional: Limit to specific GPU(s)
    # environment:
    #   CUDA_VISIBLE_DEVICES: "0"  # Use only GPU 0
    #   # or "0,1" for first two GPUs