===============================================================================
     PROJECT IMPLEMENTATION PLAN: RESEARCH ASSISTANT (RAG + CREWAI)
===============================================================================

-------------------------------------------------------------------------------
PHASE A: DEVCONTAINER AS A COMPOSE SERVICE (FOUNDATION)
-------------------------------------------------------------------------------
GOAL: 
  VS Code attaches to dev service; dev shares network with weaviate, postgres, 
  n8n, etc.

DELIVERABLES:
  [ ] Add 'dev' service to docker/docker-compose.yml
  [ ] Update .devcontainer/devcontainer.json to use:
      - dockerComposeFile
      - service: "dev"
  [ ] Add docker/Dockerfile (shared Python image)
  [ ] Add healthchecks + depends_on health where useful

OUTPUT CHECK:
  - Open Devcontainer in VS Code.
  - Test connectivity: python -c "import requests; ... weaviate ..."
  - Verify testing: Run 'pytest' from inside the dev container.


-------------------------------------------------------------------------------
PHASE B: API SERVICE IN COMPOSE (FASTAPI)
-------------------------------------------------------------------------------
GOAL: 
  One stable HTTP API for RAG (and later CrewAI).

DELIVERABLES:
  [ ] Add 'api' service in compose using the same shared Python image.
  [ ] FastAPI app with endpoints:
      - GET /health
      - POST /rag/query (calls your pipeline)
      - (Optional) POST /rag/ingest

OUTPUT CHECK:
  - Run: curl http://localhost:8000/health
  - Ensure n8n can call http://api:8000/ from inside the stack network.


-------------------------------------------------------------------------------
PHASE C: OLLAMA MINIMAL SETUP
-------------------------------------------------------------------------------
GOAL: 
  Ollama reachable as http://ollama:11434 from api, crew, and dev services.

DELIVERABLES:
  [ ] Add 'ollama' service (CPU baseline).
  [ ] Document environment variables (Base URL).

OUTPUT CHECK:
  - From dev: curl http://ollama:11434/api/tags returns model list.


-------------------------------------------------------------------------------
PHASE D: CREWAI AS ITS OWN SERVICE (SHARED IMAGE)
-------------------------------------------------------------------------------
GOAL: 
  CrewAI runs in Docker (no local venv), utilizes Ollama + Weaviate.

DELIVERABLES:
  [ ] Set up 'crew' service in compose using the shared image.
  [ ] Set up src/crew folder and files for crewai logic.
  [ ] Set up crewai api Connection (either inside src/crew or src/api)
      -> Own API, seperate from our main api

OUTPUT CHECK:
  - n8n triggers a crew run and receives a response.
  - Crew queries RAG via internal call (direct import or API endpoint).


-------------------------------------------------------------------------------
PHASE E: OPTIMIZE CORE RAG (HARDENING + DEMOABILITY)
-------------------------------------------------------------------------------
GOAL: 
  Predictable retrieval, stable schema, easy demo.

DELIVERABLES:
  [ ] Lock Weaviate Schema:
      - Disable auto-schema.
      - Define classes and properties explicitly.
  [ ] Deterministic Ingestion:
      - Stable chunk order.
      - Stable doc IDs (hash-based).
  [ ] CLI Entrypoint:
      - python -m rag.cli query "..." (sanity check).
  [ ] One-command Demo:
      - 'make demo' or simple script + README.

OUTPUT CHECK:
  - Rebuild index twice -> identical doc IDs and similar results.
  - Schema is created explicitly on startup.


-------------------------------------------------------------------------------
PHASE F: TRULENS + GUARDRAILS
-------------------------------------------------------------------------------
GOAL: 
  Evaluation and safety/quality gates on the pipeline.

DELIVERABLES:
  [ ] Add as optional profile (--profile eval).
  [ ] Instrument endpoints or pipeline calls for metrics.


-------------------------------------------------------------------------------
PHASE G: QOL + CI
-------------------------------------------------------------------------------
DELIVERABLES:
  [ ] CI Workflow: pytest + minimal integration tests.
  [ ] Linting/Formatting hooks.
  [ ] Development helper scripts.


-------------------------------------------------------------------------------
PHASE H: DEEPL (OPTIONAL)
-------------------------------------------------------------------------------
DELIVERABLES:
  [ ] Add translation step as a tool node in n8n or inside api/crew tools.


===============================================================================
CROSS-WIRING RULES (APPLY THROUGHOUT)
===============================================================================
1. HEALTHCHECKS: Use 'depends_on: condition: service_healthy' 
   (e.g., api -> weaviate).
2. DNS NAMES: Keep names stable (weaviate, ollama, api, crew). 
   Never depend on 'localhost' inside containers.
3. COMPOSE PROFILES:
   - 'default': infra + api
   - 'dev':     add devcontainer service
   - 'agents':  add crew + ollama
   - 'eval':    add trulens/guardrails
===============================================================================